{"version":3,"sources":["webpack://flarum-ext-acgembed-rr/webpack/bootstrap","webpack://flarum-ext-acgembed-rr/external \"flarum.core.compat['common/Model']\"","webpack://flarum-ext-acgembed-rr/external \"flarum.core.compat['forum/app']\"","webpack://flarum-ext-acgembed-rr/external \"flarum.core.compat['common/extend']\"","webpack://flarum-ext-acgembed-rr/external \"flarum.core.compat['forum/components/CommentPost']\"","webpack://flarum-ext-acgembed-rr/external \"flarum.core.compat['common/models/Post']\"","webpack://flarum-ext-acgembed-rr/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://flarum-ext-acgembed-rr/./src/forum/models/MediaInfo.ts","webpack://flarum-ext-acgembed-rr/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://flarum-ext-acgembed-rr/./src/forum/index.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","flarum","core","compat","_setPrototypeOf","e","setPrototypeOf","__proto__","MediaInfo","_Model","_this","_len","arguments","length","args","Array","_key","apply","concat","createdAt","Model","attribute","transformDate","updatedAt","title","url","poster","desc","source","post","hasOne","constructor","app","initializers","add","Post","hasMany","store","models","extend","CommentPost","t_media_infos","this","attrs","mediaInfoRec","forEach","media_info","$","id","find","each","elem","hasClass","addClass","_content","_content2","_iframe$attr2","_info$poster","_info$poster2","content","firstChild","cloneNode","_info","querySelector","infoObj","html","attr","info","translator","trans","join","embedPlayer","iframe","insertAfter","coverElem","bgHTML","on","cover","_iframe$attr","parent","_","_$$attr","fadeIn","removeClass","fadeOut","enableEmbedElem","console","log"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n","module.exports = flarum.core.compat['common/Model'];","module.exports = flarum.core.compat['forum/app'];","module.exports = flarum.core.compat['common/extend'];","module.exports = flarum.core.compat['forum/components/CommentPost'];","module.exports = flarum.core.compat['common/models/Post'];","function _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nexport { _setPrototypeOf as default };","import Model from 'flarum/common/Model';\n\n// For more details about frontend models\n// checkout https://docs.flarum.org/extend/models.html#frontend-models\n\nexport default class MediaInfo extends Model {\n  createdAt = Model.attribute('createdAt', Model.transformDate);\n  updatedAt = Model.attribute('updatedAt', Model.transformDate);\n  title = Model.attribute('title');\n  url = Model.attribute('url');\n  poster = Model.attribute('poster');\n  desc = Model.attribute('desc');\n  source = Model.attribute('source');\n  post = Model.hasOne('post');\n}\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nfunction _inheritsLoose(t, o) {\n  t.prototype = Object.create(o.prototype), t.prototype.constructor = t, setPrototypeOf(t, o);\n}\nexport { _inheritsLoose as default };","import app from 'flarum/forum/app';\r\nimport { extend, override } from 'flarum/common/extend';\r\nimport CommentPost from 'flarum/forum/components/CommentPost';\r\nimport Post from 'flarum/common/models/Post';\r\nimport Model from 'flarum/common/Model';\r\nimport MediaInfo from './models/MediaInfo';\r\n// We provide our extension code in the form of an \"initializer\".\r\n// This is a callback that will run after the core has booted.\r\napp.initializers.add('xypp/acgembed-rr', function (app) {\r\n    // @ts-ignore\r\n    Post.prototype.MediaInfo = Model.hasMany('media-infos');\r\n    app.store.models['media-infos'] = MediaInfo;\r\n    function enableEmbedElem(iframe: JQuery<HTMLElement>, cover: JQuery<HTMLElement>) {\r\n        $(\".acgembed-rr-cover.hide\").parent().find(\"iframe\").each((_, elem) => {\r\n            $(elem).attr(\"src\", $(elem).attr(\"data-poster\") ?? \"\");\r\n            $(elem).addClass(\"acgembed-covered\");\r\n        });\r\n        $(\".acgembed-rr-cover.hide\").fadeIn();\r\n        $(\".acgembed-rr-cover.hide\").removeClass(\"hide\");\r\n        cover.fadeOut();\r\n        cover.addClass(\"hide\");\r\n        iframe.attr(\"src\", iframe.attr(\"data-src\") ?? \"\");\r\n        iframe.removeClass(\"acgembed-covered\");\r\n    }\r\n\r\n    extend(CommentPost.prototype, [\"oncreate\",\"onupdate\"], function () {\r\n        const t_media_infos = (this.attrs.post as any).MediaInfo() as MediaInfo[];\r\n        const mediaInfoRec: Record<string, MediaInfo> = {};\r\n        t_media_infos.forEach((media_info) => {\r\n            mediaInfoRec[media_info.source() + \":\" + media_info.url()] = media_info;\r\n        });\r\n        $(`.PostStream-item[data-id=${this.attrs.post.id()}]`).find(\".acgembed-rr-template\").each((i, elem) => {\r\n            if ($(elem).hasClass(\"init\")) {\r\n                return;\r\n            }\r\n            $(elem).addClass(\"init\");\r\n            try {\r\n                const content = (elem as unknown as HTMLTemplateElement)?.content?.firstChild?.cloneNode(true);\r\n                const _info = (elem as unknown as HTMLTemplateElement)?.content?.querySelector(\"a\")?.cloneNode(true);\r\n                if (!content || !_info || !$(_info)) return;\r\n                const infoObj: MediaInfo = mediaInfoRec[$(_info).html() + \":\" + $(_info).attr(\"href\")];\r\n                const info = {\r\n                    title: app.translator.trans(\"xypp-acgembed-rr.forum.unknown-title\", [$(_info).html() as string] as any).join(\"\"),\r\n                    desc: app.translator.trans(\"xypp-acgembed-rr.forum.unknown\"),\r\n                    poster: \"\"\r\n                }\r\n                if (infoObj) {\r\n                    info.title = infoObj.title() as string;\r\n                    info.desc = infoObj.desc() as string;\r\n                    info.poster = infoObj.poster() as string;\r\n                }\r\n                const embedPlayer = $(content);\r\n                const iframe = embedPlayer.find(\"iframe\");\r\n                iframe.attr(\"data-src\", iframe.attr(\"src\") ?? \"\");\r\n                iframe.attr(\"data-poster\", info.poster ?? \"about:blank\");\r\n                iframe.attr(\"src\", info.poster ?? \"about:blank\");\r\n                iframe.addClass(\"acgembed-covered\");\r\n                embedPlayer.insertAfter(elem);\r\n                const coverElem = $(\"<div></div>\");\r\n                coverElem.addClass(\"acgembed-rr-cover\");\r\n                const bgHTML = info.poster && `<div class='acgembed-rr bg' style='background-image:url(\"${info.poster}\")'></div>`\r\n                coverElem.html(`${bgHTML}<div class='acgembed-rr title'>${info.title}</div><div class='acgembed-rr desc'>${info.desc}</div><div>${app.translator.trans(\"xypp-acgembed-rr.forum.play\")}</div>`)\r\n                coverElem.insertAfter(iframe);\r\n                coverElem.on(\"click\", () => {\r\n                    enableEmbedElem($(iframe), $(coverElem));\r\n                });\r\n            } catch (e) {\r\n                console.log(e);\r\n            }\r\n        });\r\n    });\r\n});"],"sourceRoot":""}